---
title: "data-sets-analysis"
author: "Luciano Hernández"
date: "`r Sys.Date()`"
output:
  pdf_document:
    toc: true
    toc_depth: 3
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(knitr)
library(googlesheets4)
library(readxl)
library(ggplot2)
library(sf)
library(osmdata)
library(ggspatial)
library(prettymapr)
library(tidyr)
library(openxlsx)
library(stringr)
library(readr)
library(lubridate)
library(ggmap)
library(viridis)
load(".RData")
```

# Extraer datos

## Siniestros buses interurbanos(1).xlsx

```{r getData0, include=FALSE}
# Siniestros buses interurbanos(1).xlsx
interurban.bus.accidents <- read_excel("data/Siniestros buses interurbanos(1).xlsx", 
    col_types = c("numeric", "numeric", "date", 
        "date", "numeric", "text", "text", 
        "text", "text", "text", "text", "text", 
        "text", "text", "text", "text", "numeric", 
        "text", "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric"))
interurban.bus.accidents$Fecha <- paste(interurban.bus.accidents$Fecha, interurban.bus.accidents$Hora %>% format(format = "%H:%M:%S")) %>% as.POSIXct(format = "%Y-%m-%d %H:%M")
interurban.bus.accidents <- interurban.bus.accidents %>% select(-Hora)
interurban.bus.accidents$Región <- interurban.bus.accidents$Región %>% as.factor()
interurban.bus.accidents$Comuna <- interurban.bus.accidents$Comuna %>% as.factor()
interurban.bus.accidents$`Tipo Accidente` <- interurban.bus.accidents$`Tipo Accidente` %>% as.factor()
interurban.bus.accidents$`Tipo (CONASET)` <- interurban.bus.accidents$`Tipo (CONASET)` %>% as.factor()
interurban.bus.accidents$Zona <- interurban.bus.accidents$Zona %>% as.factor()
interurban.bus.accidents$`Ubicación Relativa` <- interurban.bus.accidents$`Ubicación Relativa` %>% as.factor()
interurban.bus.accidents$`Causa (CONASET)` <- interurban.bus.accidents$`Causa (CONASET)` %>% as.factor()
interurban.bus.accidents$`Causa Accidente` <- interurban.bus.accidents$`Causa Accidente` %>% as.factor()
```

- Se unieron "Fecha" y "Hora" en una misma columna
- "Región", "Comuna", "Tipo Accidente", "Tipo (CONASET)", "Zona", "Ubicación Relativa", "Causa (CONASET)" y "Causa Accidente" pasaron de ser tipo "character" a tipo "factor" para un mejor procesamiento

## GH026929.xlsx

```{r getData1, include=FALSE}
# GH026929.xlsx
gh026929 <- read_excel("data/GH026929.xlsx", 
    range = "A1:L1727", col_types = c("numeric", 
        "date", "text", "numeric", "numeric", 
        "numeric", "numeric", "skip", "skip", 
        "numeric", "numeric", "numeric"))

## ¿Qué es cts?
## Rangos altura
## ¿Qué es fix?
## U.M. precision

gh026929$date <- paste(gh026929$date, gh026929$hora) %>% as.POSIXct(format = "%Y-%m-%d %H:%M")
gh026929 <- gh026929 %>% select(-hora)
reduce.coords <- function(n) {
  n * 10 ^ (1 - (n %>% abs() %>% log10() %>% floor()))
}
gh026929$`GPS (Lat.) [deg]` <- gh026929$`GPS (Lat.) [deg]` %>% reduce.coords()
gh026929$`GPS (Long.) [deg]` <- gh026929$`GPS (Long.) [deg]` %>% reduce.coords()
gh026929 %>% summary()
```

- Se unieron "date" y "hora" en una misma columna
- "GPS (Lat.) [deg]" y "GPS (Long.) [deg]" no tenían el punto decimal, por lo que, debido al contexto de que los datos son de Chile, se tomó como parte entera los primeros 2 dígitos mediante la siguiente fórmula:

$$\text{reduce.coords}(n)\equiv n\times10^{1-\lfloor\log_{10}|n|\rfloor}$$

## Data accidentes de carabineros.xlsx

```{r getData2, include=FALSE}
# Data accidentes de carabineros.xlsx
police.accidents <- read_excel("data/Data accidentes de carabineros.xlsx", 
    col_types = c("numeric", "date", "skip", 
        "date", "text", "text", "text", "text", 
        "text", "numeric", "numeric", "numeric", 
        "numeric", "numeric", "text", "text", 
        "text", "text", "text"))
police.accidents$FECHA <- paste(police.accidents$FECHA, police.accidents$HORA %>% format(format = "%H:%M:%S")) %>% as.POSIXct(format = "%Y-%m-%d %H:%M")
police.accidents <- police.accidents %>% select(-HORA)
police.accidents$ZONA <- police.accidents$ZONA %>% as.factor()
police.accidents$COMUNA <- police.accidents$COMUNA %>% as.factor()
police.accidents$TIPO <- police.accidents$TIPO %>% as.factor()
police.accidents$CAUSA <- police.accidents$CAUSA %>% as.factor()
police.accidents$SECTOR <- police.accidents$SECTOR %>% as.factor()
police.accidents$KM[!(police.accidents$KM %>% is.na())] <- police.accidents$KM[!(police.accidents$KM %>% is.na())] %>% as.numeric()
police.accidents$PARTE <- police.accidents$PARTE %>% as.numeric()
police.accidents %>% summary()
```

- Se unieron "FECHA" y "HORA" en una misma columna
- "ZONA", "COMUNA", "TIPO", "CAUSA" y "SECTOR" pasaron de ser tipo "character" a tipo "factor" para un mejor procesamiento
- "KM" pasó de ser tipo "character" a tipo "numeric" en las partes en las que no es nulo
- "PARTE" pasó de ser tipo "character" a tipo "numeric"

## Incidentes de tráfico radio.xlsx

```{r getData3, include=FALSE}
# Incidentes de tráfico radio.xlsx
file.path <- "data/Incidentes de tráfico radio.xlsx"
sheet.names <- file.path %>% excel_sheets()
date.sheets <- sheet.names[grepl("^\\d{1,2}-\\d{1,2}$", sheet.names)]
radio.accidents <- list()
for(sheet in date.sheets) {
  df <- file.path %>% read_excel(sheet = sheet)
  day.month <- (sheet %>% strsplit(., "-"))[[1]]
  day <- day.month[1] %>% as.numeric()
  month <- day.month[2] %>% as.numeric()
  ## ¿De qué año es?
  comp.date <- paste("2025", month, day, sep = "-") %>% as.Date()
  df$fecha <- comp.date
  df$`#ID` <- df$`#ID` %>% as.numeric()
  df$Hora <- df$Hora %>% as.numeric() %>% as.POSIXct() %>% format(format = "%H:%M")
  radio.accidents[[sheet]] <- df
}
radio.accidents.df <- radio.accidents %>% bind_rows()
radio.accidents.df <- radio.accidents.df[!(radio.accidents.df$coord %>% is.na()),]
radio.accidents.df$coord[!(radio.accidents.df$lat %>% is.na())] <- radio.accidents.df$lat[!(radio.accidents.df$lat %>% is.na())]
radio.accidents.df <- radio.accidents.df %>% select(-c(lat, `Tipo de incidente`, `tipo de incidente`, ...7, ...13))
radio.accidents.df$dir[!(radio.accidents.df$...12 %>% is.na()) & (radio.accidents.df$dir %>% is.na())] <- radio.accidents.df$...12[!(radio.accidents.df$...12 %>% is.na()) & (radio.accidents.df$dir %>% is.na())]
radio.accidents.df <- radio.accidents.df %>% select(-...12)
radio.accidents.df$`Reporte completo? (SI/NO)`[(radio.accidents.df$`Reporte completo? (SI/NO)` %in% c("is", "si", "SI", "su")) %>% which()] = "SI"
radio.accidents.df$`Reporte completo? (SI/NO)`[(radio.accidents.df$`Reporte completo? (SI/NO)` %in% c("no", "NO")) %>% which()] = "NO"
radio.accidents.df$`Reporte completo? (SI/NO)`[(radio.accidents.df$`Reporte completo? (SI/NO)` == "-") %>% which()] = NA
radio.accidents.df$`es incidente de tráfico? (si/no)`[(radio.accidents.df$`es incidente de tráfico? (si/no)` %in% c("si", "SI")) %>% which()] <- "SI"
radio.accidents.df$`es incidente de tráfico? (si/no)`[(radio.accidents.df$`es incidente de tráfico? (si/no)` %in% c("no", "NO")) %>% which()] <- "NO"
radio.accidents.df$dir[radio.accidents.df$dir %in% c("-", "a/s", "n/a", "n/A")] <- NA
radio.accidents.df$dir[radio.accidents.df$dir %in% c("e-o", "E-O")] <- "E-O"
radio.accidents.df$dir[radio.accidents.df$dir %in% c("o-e", "O-E")] <- "O-E"
radio.accidents.df$dir[radio.accidents.df$dir %in% c("n-s", "n.s", "N-S")] <- "N-S"
radio.accidents.df$dir[radio.accidents.df$dir %in% c("s-n", "S-N")] <- "S-N"
radio.accidents.df$dir[radio.accidents.df$dir %in% c("n-s. s-n", "n-s.s-n", "N-S, S-N")] <- "N-S, S-N"
radio.accidents.df$dir[radio.accidents.df$dir %in% c("s-n.n-s", "S-N, N-S")] <- "S-N, N-S"
radio.accidents.df$`Reporte completo? (SI/NO)` <- radio.accidents.df$`Reporte completo? (SI/NO)` %>% as.factor()
radio.accidents.df$`es incidente de tráfico? (si/no)` <- radio.accidents.df$`es incidente de tráfico? (si/no)` %>% as.factor()
radio.accidents.df$dir <- radio.accidents.df$dir %>% as.factor()
radio.accidents.df <- radio.accidents.df %>% fill(Hora, .direction = "down")
radio.accidents.df <- radio.accidents.df %>% separate(coord, into = c("lat", "lng"), sep = ",\\s*") %>% mutate(lat = lat %>% as.numeric(), lng = lng %>% as.numeric())
radio.accidents.df <- radio.accidents.df[!(radio.accidents.df$lat %>% is.na()),]
radio.accidents.df$Hora <- paste(radio.accidents.df$fecha, radio.accidents.df$Hora) %>% as.POSIXct(format = "%Y-%m-%d %H:%M")
radio.accidents.df <- radio.accidents.df %>% select(-fecha)
radio.accidents.df %>% summary()
```

- Se buscaron las hojas cuyo nombre incluye el caracter "-", indicando que son fechas
- Se creó un "data.frame" por cada hoja
- Se creó la columna "fecha" a partir del nombre de la hoja
- "#ID" se volvió de tipo "numeric"
- Se unieron los "data.frame" en uno
- Se eliminaron las filas en las que "coord" es nulo
- Se eliminaron "Tipo de incidente", "tipo de incidente", "...7", "...13" debido que todos sus valores son nulos
- "Reporte completo? (SI/NO)" pasó a tener los siguientes valores:
  - "SI" si originalmente era "is", "si", "SI" o "su"
  - "NO" si originalmente era "no" o "NO"
  - Nulo si originalmente era "-" o nulo
- "es incidente de tráfico? (si/no)" pasó a tener los siguientes valores:
  - "SI" si originalmente era "si" o "SI"
  - "NO" si originalmente era "no" o "NO"
  - Nulo si originalmente era nulo
- "dir" pasó a tener los siguientes valores:
  - Nulo si originalmente era "-", "a/s", "n/a", "n/A" o nulo
  - "E-O" si originalmente era "e-o" o "E-O"
  - "O-E" si originalmente era "o-e" u "O-E"
  - "N-S" si originalmente era "n-s", "n.s" o "N-S"
  - "N-S, S-N" si originalmente era "n-s. s-n", "n-s.s-n" o "N-S, S-N"
  - "S-N, N-S" si originalmente era "s-n.n-s" o "S-N, N-S"
- "Reporte completo? (SI/NO)", "es incidente de tráfico? (si/no)", "dir" pasaron de ser tipo "character" a tipo "factor" para un mejor procesamiento
- Las filas donde "Hora" es nulo se rellenaron con el valor de la fila anterior
- "coord" se separó en las columnas "lat" y "lng"
- Se unieron "Hora" y "fecha" en una misma columna

## Med velo CHIGUAYANTE.xlsx

```{r getData3, include=FALSE}
# Med velo CHIGUAYANTE.xlsx
file.path <- "data/Med velo CHIGUAYANTE.xlsx"
directions <- file.path %>% excel_sheets()
chiguayante.speed <- list()
for(sheet in directions) {
  df <- file.path %>% read_excel(sheet = sheet)
  ## ¿De qué fecha es?
  df$dirección <- sheet
  df$`Lugar (dirección)` <- df$`Lugar (dirección)`[!(df$`Lugar (dirección)` %>% is.na())] %>% paste(collapse = ", ")
  chiguayante.speed[[sheet]] <- df
}
chiguayante.speed.df <- chiguayante.speed %>% bind_rows()
chiguayante.speed.df <- chiguayante.speed.df %>% select(-c(...5, ...6, ...7, ...8, ...9, ...10, ...11, ...12, ...13))
chiguayante.speed.df <- chiguayante.speed.df[!(chiguayante.speed.df$`Velocidad [km/hr]` %>% is.na()),]
chiguayante.speed.df <- chiguayante.speed.df %>% fill(Hora, .direction = "down")
chiguayante.speed.df$Comentario <- chiguayante.speed.df$Comentario %>% as.factor()
chiguayante.speed.df$dirección <- chiguayante.speed.df$dirección %>% as.factor()
chiguayante.speed.df$`Lugar (dirección)` <- chiguayante.speed.df$`Lugar (dirección)` %>% as.factor()
chiguayante.speed.df %>% summary()
```

- Se creó un "data.frame" por cada hoja
- Debido a que "Lugar (dirección)" tiene sólo un valor por hoja, se unieron todas sus celdas en un sólo valor que sería para todas las filas
- Se creó la columna "dirección" a partir del nombre de la hoja
- Se unieron los "data.frame" en uno
- Se eliminaron las columnas "...5", "...6", "...7", "...8", "...9", "...10", "...11", "...12" y "...13"
- Se eliminaron las filas en las que "Velocidad [km/hr]" es nulo
- Las filas donde "Hora" es nulo se rellenaron con el valor de la fila anterior
- "Comentario", "dirección" y "Lugar (dirección)" pasaron de ser tipo "character" a tipo "factor" para un mejor procesamiento

## Med velo LA VEGA.xlsx

```{r getData4, include=FALSE}
#Med velo LA VEGA.xlsx
file.path <- "data/Med velo LA VEGA.xlsx"
sheets <- excel_sheets(file.path)
directions <- sheets[grepl("21", sheets) & grepl("mayo", sheets)]
vega.speed <- list()
for(sheet in directions) {
  df <- file.path %>% read.xlsx(sheet = sheet, colNames = T, fillMergedCells = TRUE, detectDates = T, skipEmptyCols = F, skipEmptyRows = F)
  df <- df[, 2:5]
  ## ¿De qué fecha es?
  df$Hora[!(df$Hora %>% is.na()) & df$Hora %>% as.numeric() > 1 & !((!(df$Hora %>% is.na()) & df$Hora %>% as.numeric() > 1) %>% is.na())] <- df$Hora[!(df$Hora %>% is.na()) & df$Hora %>% as.numeric() > 1 & !((!(df$Hora %>% is.na()) & df$Hora %>% as.numeric() > 1) %>% is.na())] %>% as.numeric() %>% round(digits = 2) %>% as.character() %>% gsub("\\.", ":", .)
  df$Hora <- df$Hora %>% as.numeric() %>% as.POSIXct(format = "%H:%M")
  df$dirección <- sheet
  df$`Lugar.(dirección)` <- df$`Lugar.(dirección)`[!(df$`Lugar.(dirección)` %>% is.na())] %>% paste(collapse = ", ")
  vega.speed[[sheet]] <- df
}
vega.speed.df <- vega.speed %>% bind_rows()
vega.speed.df <- vega.speed.df[!(vega.speed.df$`Velocidad.[km/hr]` %>% is.na()),]
vega.speed.df <- vega.speed.df %>% fill(Hora, .direction = "down")
vega.speed.df$Comentario <- vega.speed.df$Comentario %>% as.factor()
vega.speed.df$`Lugar.(dirección)` <- vega.speed.df$`Lugar.(dirección)` %>% as.factor()
vega.speed.df$dirección <- vega.speed.df$dirección %>% as.factor()
vega.speed.df %>% summary()
```

- Se buscaron las hojas cuyo nombre incluye las palabras "21" y "mayo", indicando que son direcciones
- Se creó un "data.frame" por cada hoja
- Se creó la columna "dirección" a partir del nombre de la hoja
- Algunas celdas de la columna "Hora" estaban en formato "%H, %M" (por ejemplo: "8,15" en lugar de "8:15") por lo que se les corrigió el formato
- Se creó la columna "dirección" a partir del nombre de la hoja
- Debido a que "Lugar.(dirección)" tiene sólo un valor por hoja, se unieron todas sus celdas en un sólo valor que sería para todas las filas
- Se unieron los "data.frame" en uno
- Se eliminaron las filas en las que "Velocidad.[km/hr]" es nulo
- Las filas donde "Hora" es nulo se rellenaron con el valor de la fila anterior
- "Comentario", "Lugar.(dirección)" y "dirección" pasaron de ser tipo "character" a tipo "factor" para un mejor procesamiento

## tb_gps_historial_eventos_202509161626(1).csv

```{r getData5, include=FALSE}
# tb_gps_historial_eventos_202509161626(1).csv
gps.events <- read_file("data/tb_gps_historial_eventos_202509161626(1).csv") %>% str_replace_all(., "\";\"", " ") %>% str_replace_all(., ",", ";") %>% str_replace_all(., "\"", "") %>% read.table(text = ., sep = ";", header = T, stringsAsFactors = F)
gps.events <- gps.events %>% select(-c(ubicacion_, velocidad_))
gps.events$fecha_auto <- gps.events$fecha_auto %>% as.POSIXct(format = "%Y-%m-%d %H:%M:%S")
gps.events$fecha_gps_ <- gps.events$fecha_gps_ %>% as.POSIXct(format = "%Y-%m-%d %H:%M:%S")
gps.events$evento_ <- gps.events$evento_ %>% as.factor()
gps.events$direccion_ <- gps.events$direccion_ %>% as.factor()
gps.events %>% summary()
```

- Se reemplazaron los '";"' por " " y los "," por ";" para poder separar las columnas
- Se eliminaron las columnas "ubicacion_" y "velocidad_" debido a que sólo abía valores nulos
- "fecha_auto" y "fecha_gps_" pasaron de ser tipo "character" a tipo "Date"
- "evento_" y "direccion_" pasaron de ser tipo "character" a tipo "factor" para un mejor procesamiento

## Inventario CCTV Biobío(1).xlsx

```{r getData6, include=FALSE}
# Inventario CCTV Biobío(1).xlsx
biobio.inventary <- read_excel("data/Inventario CCTV Biobío(1).xlsx", 
    range = "A2:Q73", na = "----")
colnames(biobio.inventary) <- ifelse(
  grepl("\\...", biobio.inventary %>% colnames()),
  paste((biobio.inventary %>% colnames() %>% str_split_fixed("\\...", n = 2) %>% as.matrix() %>% {.[. == ""] <- NA; .})[, 1], ifelse((biobio.inventary %>% colnames() %>% str_split_fixed("\\...", n = 2) %>% as.matrix() %>% {.[. == ""] <- NA; .})[, 2] %>% as.numeric() <= 11, "DE LA CÁMARA", "DEL CODIFICADOR DE VIDEO")),
  biobio.inventary %>% colnames()
)
biobio.inventary$COMUNA <- biobio.inventary$COMUNA %>% as.factor()
biobio.inventary$ESTADO <- biobio.inventary$ESTADO %>% as.factor()
biobio.inventary$`TIPO DE ENLACE` <- biobio.inventary$`TIPO DE ENLACE` %>% as.factor()
biobio.inventary$PROVEEDOR <- biobio.inventary$PROVEEDOR %>% as.factor()
biobio.inventary$`MARCA DE LA CÁMARA` <- biobio.inventary$`MARCA DE LA CÁMARA` %>% as.factor()
biobio.inventary$`MODELO DE LA CÁMARA` <- biobio.inventary$`MODELO DE LA CÁMARA` %>% as.factor()
biobio.inventary$`MARCA DEL CODIFICADOR DE VIDEO` <- biobio.inventary$`MARCA DEL CODIFICADOR DE VIDEO` %>% as.factor()
biobio.inventary$`MODELO DEL CODIFICADOR DE VIDEO` <- biobio.inventary$`MODELO DEL CODIFICADOR DE VIDEO` %>% as.factor()
biobio.inventary$REGIÓN <- biobio.inventary$REGIÓN %>% as.factor()
biobio.inventary %>% summary()
```

- Debido a que las columnas "MARCA", "MODELO" y "NÚMERO DE SERIE" estaban repetidos, se les agregó "DE LA CÁMARA" y "DEL CODIFICADOR DE VIDEO" a cada uno
- "COMUNA", "ESTADO", "TIPO DE ENLACE", "PROVEEDOR", "MARCA DE LA CÁMARA", "MODELO DE LA CÁMARA", "MARCA DEL CODIFICADOR DE VIDEO", "MODELO DEL CODIFICADOR DE VIDEO" y "REGIÓN" pasaron de ser tipo "character" a tipo "factor" para un mejor procesamiento

## Alertas de Tráfico.csv

```{r getData7, include=FALSE}
# Alertas de Tráfico.csv
trafic.alerts <- read_csv("data/Alertas de Tráfico.csv")
trafic.alerts <- trafic.alerts %>% mutate(
  lng = str_extract(Location, "(?<=Point\\()-?\\d+\\.?\\d*") %>% as.numeric(),
  lat = str_extract(Location, "-?\\d+\\.?\\d*(?=\\)$)") %>% as.numeric()
)
trafic.alerts <- trafic.alerts %>% select(-Location)
trafic.alerts$Date <- trafic.alerts$Date %>% str_replace_all(., setNames(
  c("jan", "feb", "mar", "apr", "may", "jun", "jul", "aug", "sep", "oct", "nov", "dec"),
  c("ene", "feb", "mar", "abr", "may", "jun", "jul", "ago", "sep", "oct", "nov", "dic")
)) %>% dmy()
trafic.alerts$Country <- trafic.alerts$Country %>% as.factor()
trafic.alerts$City <- trafic.alerts$City %>% as.factor()
trafic.alerts$Type <- trafic.alerts$Type %>% as.factor()
trafic.alerts$Subtype <- trafic.alerts$Subtype %>% as.factor()
trafic.alerts %>% summary()
```

- "Location" se separó en las columnas "lng" y "lat"
- "Date" pasó de ser tipo "character" a tipo "Date"
- "Country", "City", "Type" y "Subtype" pasaron de ser tipo "character" a tipo "factor" para un mejor procesamiento

## Copia de Accidentes.csv

```{r getData8, include=FALSE}
# Copia de Accidentes.csv
accidents <- read_csv("data/Copia de Accidentes.csv")
accidents <- accidents %>% mutate(
  lng = str_extract(Location, "(?<=Point\\()-?\\d+\\.?\\d*") %>% as.numeric(),
  lat = str_extract(Location, "-?\\d+\\.?\\d*(?=\\)$)") %>% as.numeric()
)
accidents <- accidents %>% select(-Location)
accidents$Date <- accidents$Date %>% str_replace_all(., setNames(
  c("jan", "feb", "mar", "apr", "may", "jun", "jul", "aug", "sep", "oct", "nov", "dec"),
  c("ene", "feb", "mar", "abr", "may", "jun", "jul", "ago", "sep", "oct", "nov", "dic")
)) %>% dmy()
accidents$Country <- accidents$Country %>% as.factor()
accidents$City <- accidents$City %>% as.factor()
accidents %>% summary()
```

- "Location" se separó en las columnas "lng" y "lat"
- "Date" pasó de ser tipo "character" a tipo "Date"
- "Country" y "City" pasaron de ser tipo "character" a tipo "factor" para un mejor procesamiento

## Waze for Cities Data Key Alerts Dashboard_Traffic Irregularities_Tabla(1).csv

```{r getData9, include=FALSE}
# Waze for Cities Data Key Alerts Dashboard_Traffic Irregularities_Tabla(1).csv
waze.data <- read_csv("data/Waze for Cities Data Key Alerts Dashboard_Traffic Irregularities_Tabla(1).csv", 
    na = "null")
waze.data$Day <- waze.data$Day %>% str_replace_all(., setNames(
  c("jan", "feb", "mar", "apr", "may", "jun", "jul", "aug", "sep", "oct", "nov", "dec"),
  c("ene", "feb", "mar", "abr", "may", "jun", "jul", "ago", "sep", "oct", "nov", "dic")
)) %>% dmy()
waze.data$Country <- waze.data$Country %>% as.factor()
waze.data$City <- waze.data$City %>% as.factor()
waze.data$Street <- waze.data$Street %>% as.factor()
waze.data$Cause <- waze.data$Cause %>% as.factor()
waze.data %>% summary()
```

- "Date" pasó de ser tipo "character" a tipo "Date"
- "Country", "City", "Street" y "Cause" pasaron de ser tipo "character" a tipo "factor" para un mejor procesamiento

# Visualizar datos

## Mapas

```{r visualizeData, include=FALSE}
bbox <- c(
  min(radio.accidents.df$lng, na.rm = TRUE) - 0.01,
  min(radio.accidents.df$lat, na.rm = TRUE) - 0.01,
  max(radio.accidents.df$lng, na.rm = TRUE) + 0.01,
  max(radio.accidents.df$lat, na.rm = TRUE) + 0.01
)
streets <- opq(bbox = bbox) %>%
  add_osm_feature(key = "highway") %>%
  osmdata_sf()
ggplot() +
  geom_sf(data = streets$osm_lines, color = "gray50", size = 0.3, alpha = 0.7) +
  stat_density_2d(
    data = radio.accidents.df,
    aes(x = lng, y = lat, fill = ..density..),
    geom = "raster",
    contour = FALSE,
    alpha = 0.6
  ) +
  scale_fill_viridis_c(name = "Densidad") +
  labs(
    title = "Mapa de calor de densidad: Incidentes de tráfico de radio",
    x = "Longitud",
    y = "Latitud"
  ) +
  theme_minimal() +
  coord_sf()
```

